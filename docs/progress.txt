## Codebase Patterns
- Use `getCurrentUserHouseholdId` from `src/server/household.ts` for household-scoped server logic.
- For filtered read server functions, use `inputValidator` and pass `{ data: {} }` when no filters are needed.
- `react-resizable-panels` exports `Group`/`Separator` (not `PanelGroup`/`PanelResizeHandle`) in this codebase.

## 2026-01-15 23:59 - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added meal CRUD server functions with validation and household scoping.
- Files changed: `src/server/meals.ts`, `src/server/household.ts`, `docs/prds/MEALS_PRD.md`
- **Learnings for future iterations:**
  - Patterns discovered: Meal server functions follow the Tasks pattern with input validators and response mapping.
  - Gotchas encountered: Export the household helper instead of re-creating it in feature server modules.
  - Useful context: Meal responses use ISO date strings for frontend consumption.
---
## 2026-01-16 12:00 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Marked household helper reuse story complete; confirmed helper is defined in `src/server/household.ts` and used by meal server functions.
- Files changed: `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: `getCurrentUserHouseholdId` is the shared helper for household scoping across server modules.
  - Gotchas encountered: Ensure PRD stories include a `passes:` line when marking completion.
  - Useful context: Household membership lookup uses `clerkUserId` in `householdMember`.
---
## 2026-01-16 00:34 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Replaced local meal state with TanStack Query fetches/mutations, added loading/error UI, and wired add/delete to server functions.
- Files changed: `src/routes/_authed/meals/index.tsx`, `src/routes/_authed/meals/-meals.test.tsx`, `docs/prds/MEALS_PRD.md`
- **Learnings for future iterations:**
  - Patterns discovered: For TanStack Query mutations, `createServerFn` receives an extra metadata argument in tests.
  - Gotchas encountered: Meal form labels need `htmlFor`/`id` pairing for RTL queries.
  - Useful context: Browser verification redirected to sign-in at `/sign-in?redirect=%2Fmeals`, so UI verification was blocked without credentials.
---
## 2026-01-16 11:55 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Switched meal day handling to use week-based Date objects, store local start-of-day ISO strings, and match meals by date keys; updated tests to use current-week dates.
- Files changed: `src/routes/_authed/meals/index.tsx`, `src/routes/_authed/meals/-meals.test.tsx`, `docs/prds/MEALS_PRD.md`
- **Learnings for future iterations:**
  - Patterns discovered: Meal week rows derive from `startOfWeek(..., { weekStartsOn: 1 })` + `addDays` with local `startOfDay`.
  - Gotchas encountered: Meal rendering now depends on current-week dates, so tests should generate dates from `startOfWeek(new Date())` to stay deterministic.
  - Useful context: Browser verification still redirects to sign-in without credentials, blocking UI validation.
---
## 2026-01-16 11:58 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Verified the Meal Planning UI in the browser, confirmed weekday dropdown shows Monday-Sunday and add form fields render alongside the weekly grid.
- Files changed: `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: Meal Planning UI renders add form inline below the header and uses accessible labels for Day/Meal Type/Meal Name.
  - Gotchas encountered: None.
  - Useful context: Browser verification passed at `/meals` with the current session.
---
## 2026-01-16 18:00 - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added week navigation with range label, scoped meal queries to the selected week, and kept add form day selection aligned to the active week.
- Files changed: `src/routes/_authed/meals/index.tsx`, `src/server/meals.ts`, `src/routes/_authed/meals/-meals.test.tsx`, `src/server/meals.test.ts`, `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: `getMeals` accepts optional week filters via `inputValidator` and expects `{ data: {} }` when no filters are passed.
  - Gotchas encountered: RTL queries for the add flow should use `findAllByRole` once multiple "Add Meal" buttons exist.
  - Useful context: Browser check confirmed week navigation controls render on `/meals`.
---
## 2026-01-16 18:20 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Added edit mode for meal cards with a shared add/edit form, update mutation wiring, and edit coverage in UI tests.
- Files changed: `src/routes/_authed/meals/index.tsx`, `src/routes/_authed/meals/-meals.test.tsx`, `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: `npx tsc --noEmit` currently fails due to unrelated type errors in `src/components/Header.tsx` and `src/components/ui/resizable.tsx`.
  - Useful context: Edit form reuses the add form layout and swaps labels/actions based on `formMode`.
---
## 2026-01-16 18:35 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Fixed unrelated typecheck errors in the header icon imports and resizable panel wrappers to unblock `tsc --noEmit`.
- Files changed: `src/components/Header.tsx`, `src/components/ui/resizable.tsx`, `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: `react-resizable-panels` exports `Group` and `Separator` components (not `PanelGroup`/`PanelResizeHandle`).
  - Gotchas encountered: None.
  - Useful context: Typecheck now passes with the updated resizable exports.
---
## 2026-01-16 18:50 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Marked browser verification complete in the PRD per user request.
- Files changed: `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: Browser automation can be flaky due to overlayed navigation; consider manual verification when it blocks automation.
  - Useful context: Dev server was running at `http://localhost:3000/meals` during attempted verification.
---
## 2026-01-16 18:55 - US-006
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Marked US-006 `passes: true` after confirming all acceptance criteria are checked.
- Files changed: `docs/prds/MEALS_PRD.md`, `docs/progress.txt`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: None.
  - Useful context: US-006 status in PRD now reflects completion.
---